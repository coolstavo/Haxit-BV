<!doctype html>
<html xmlns:th="http://www.thymeleaf.org" lang="nl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Jam Details</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />
    <link rel="stylesheet" th:href="@{/css/style.css}" />
    <style>
      #jamLocationMap {
        height: 300px;
        width: 100%;
        border-radius: 8px;
      }
    </style>
  </head>
  <body class="bg">
    <div th:insert="~{fragments/_navbar :: navbar}"></div>

    <div class="container mt-4">
      <!-- Header -->
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h3>
          <span th:text="${jam.title}">Jam Titel</span>
          <small
            class="text-muted"
            th:if="${jam.muzikantUser}"
            th:text="'door ' + ${jam.muzikantUser.username}"</h3>
            >door Muzikant</small
          >
        </h3>
        <span class="badge bg-warning text-dark" th:if="${isOwner}">Jouw Jam</span>
      </div>

      <div class="row">
        <!-- Left column: Jam Details -->
        <div class="col-md-6">
          <div class="card shadow-sm mb-4">
            <div class="card-header bg-light">
              <h5 class="mb-0">üéµ Jam Details</h5>
            </div>
            <div class="card-body">
              <p>
                <strong>Titel:</strong>
                <span th:text="${jam.title}">-</span>
              </p>
              <p th:if="${jam.muzikantUser}">
                <strong>Muzikant:</strong>
                <span th:text="${jam.muzikantUser.username}">-</p></span>
              </p>
              <p>
                <strong>Beschrijving:</strong>
              </p>
              <p
                style="white-space: pre-line; margin-bottom: 0"
                th:text="${jam.description}"
              >
                -
              </p>
            </div>
          </div>

          <div th:if="${isOwner}" class="card shadow-sm mb-4 border-danger">
            <div class="card-header bg-danger text-white">
              <h5 class="mb-0">‚ö†Ô∏è Gevaarlijk Gebied</h5>
            </div>
            <div class="card-body">
              <form
                method="post"
                th:action="@{'/jam/' + ${jam.id} + '/' + ${username} + '/delete'}"
                onsubmit="
                  return confirm(
                    'Weet je zeker dat je deze jam wilt verwijderen?',
                  );
                "
              >
                <button type="submit" class="btn btn-danger">
                  üóëÔ∏è Jam Verwijderen
                </button>
              </form>
            </div>
          </div>
        </div>

        <!-- Right column: Location -->
        <div class="col-md-6">
          <div class="card shadow-sm">
            <div class="card-header bg-light">
              <h5 class="mb-0">üìç Locatie</h5>
            </div>
            <div class="card-body">
              <div id="jamLocationMap"></div>
              <p class="mt-3 mb-0">
                <strong>Co√∂rdinaten:</strong><br />
                Latitude: <span th:text="${jam.lat}">-</span><br />
                Longitude: <span th:text="${jam.lng}">-</span>
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- Likes and Comments Section -->
      <div th:insert="~{fragments/_likes-comments :: likesComments('jam', ${jam.id}, ${username}, ${likeCount}, ${userHasLiked}, ${comments})}"></div>

      <!-- Back Button -->
      <div class="mb-4 mt-4">
        <a href="javascript:history.back()" class="btn btn-secondary"
          >‚Üê Terug</a
        >
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
      // Initialize map for jam location
      const maxBounds = L.latLngBounds(
        L.latLng(52.9, 6.0),
        L.latLng(53.6, 7.3),
      );

      const jamMap = L.map("jamLocationMap", {
        maxBounds: maxBounds,
        maxBoundsViscosity: 1.0,
      }).setView(
        [/*[[${jam.lat}]]*/ 53.2194, /*[[${jam.lng}]]*/ 6.5665],
        15,
      );

      jamMap.setMaxBounds(maxBounds);

      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        maxZoom: 19,
        attribution: "&copy; OpenStreetMap-bijdragers",
      }).addTo(jamMap);

      const pinIcon = L.icon({
        iconUrl: "/assets/pin-red.png",
        iconSize: [15, 40],
        iconAnchor: [15, 40],
        popupAnchor: [-6, -40],
      });

      const marker = L.marker(
        [/*[[${jam.lat}]]*/ 53.2194, /*[[${jam.lng}]]*/ 6.5665],
        { icon: pinIcon },
      ).addTo(jamMap);

      marker.bindPopup(
        "<b>" +
          /*[[${jam.title}]]*/ "" +
          "</b><br>" +
          /*[[${jam.description}]]*/ "",
      );
      marker.openPopup();
    </script>
  </body>
</html>
